# 락

## 🐣 락??
:::tip  
트랜잭션 처리의 순차성을 보장하기 위한 장치 
- Lock은 데이터베이스에 여러 사용자들이 같은 데이터를 동시에 접근하는 상황에서, 데이터의 무결성을 지킴
:::

###### *트랜잭션
> ###### DB의 나누어지지 않는 최소한의 처리 단위

.

## 🐣 락의 종류는?
:::tip
- 공유락 (Shared Lock)
- 베타락 (Exclusive Lock)
- 업데이트락 (Update Lock)
- 내재락 (Intent Lock)

:::

### 🥚 공유락 (Shared Lock)

`데이터를 읽을 때 사용되는 Lock` (aka Read Lock)

- 공유락끼리는 동시에 접근이 가능
    - 즉, 하나의 데이터를 읽는 것은 여러 사용자가 동시에 할 수 있음
    - 하지만 공유 Lock이 설정된 데이터에 베타 Lock을 사용할 수는 없음

### 🥚 베타락 (Exclusive Lock)

`데이터를 변경 할 때 사용되는 락` aka Write Lock

- 베타락은 Lock이 해제될 때까지 다른 트랜잭션(읽기 포함)은 해당 리소스에 접근할 수 없음.
- 해당 Lock은 다른 트랜잭션이 수행되고 있는 데이터에 접근하여 동시에 Lock을 설정할 수 없음.
- 트랜잭션이 완료될 때까지 유지

### 🥚 업데이트 락(Update Lock)

`데드락 방지용 락`

- 데이터를 수정하기 위해 베타락(X)을 걸기 전, 데드 락을 방지하기 위해 사용되는 락이다
- 일반적으로 UPDATE 쿼리의 필터(WHERE)가 실행되는 과정에서 적용된다

### 🥚 내재 락(Intent Lock)

`락을 걸수 있는지 여부판단을 위해 거는 락`

- 내재 락은 사용자가 요청한 범위에 대한 락을 걸 수 있는지 여부를 빠르게 파악하기 위해 사용되는 락
- 내재 락은 공유 락과 베타 락 앞에 I 기호를 붙인 IS, IX, SIX 등이 있다

.

## 🐣 락의 설정범위 (Level)
:::tip
위로갈수록 Wide / 밑으로 갈수록 Specific
1. 데이터베이스
2. 파일
3. 테이블
4. 페이지와 블럭
5. 컬럼
6. 행(Row)
:::

- 데이터베이스
  - 전체 데이터베이스를 기준으로 lock
    - 1개의 세션만이 DB의 데이터에 접근이 가능합니다.
  - 해당 기능은 일반적으로는 사용하지 않음
    - DB의 소프트웨어 버전업 등 주요한 DB의 업데이트 등에만 사용
- 파일
  - 데이터베이스 파일을 기준으로 lock
    - 파일 이란 테이블, row 등과 같은 실제 데이터가 쓰여지는 물리적인 저장소
  - 해당 범위의 Lock은 잘 사용되지는 않습니다.
- **`테이블`**
  - 테이블을 기준으로 Lock
  - 테이블의 모든 행을 업데이트 하는 등의 전체 테이블에 영향을 주는 변경을 할때 유용
    - 즉, DDL(create, alter, drop 등) 구문과 함께 사용되며 `DDL Lock`이라고도 합니다.
- 페이지와 블럭
  - 파일의 일부인 페이지와 블록을 기준으로 Lock
  - 잘 사용되지는 않습니다.
- 컬럼
  - 컬럼을 기준으로 Lock
  - 이 형식은 Lock 설정 및 해제의 리소스가 많이 들기 때문에 일반적으로 사용되지는 않습니다
    - 지원하는 DBMS도 많지 않습니다.
- **`행(Row)`**
  - 1개의 행(Row)를 기준으로 Lock
  - DML에 대한 Lock으로 가장 일반적으로 사용하는 Lock입니다.